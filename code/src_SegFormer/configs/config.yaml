# =============================================================================
# SegFormer B3 - Scientific Image Forgery Detection
# OPTIMIZED for maximum performance on 12 GB VRAM (~47M params)
# =============================================================================

# -----------------------------------------------------------------------------
# Experiment Settings
# -----------------------------------------------------------------------------
experiment:
  name: "segformer_b5_forgery_lrnew_blackbones5"
  seed: 42
  work_dir: "./work_dir_segformer_b5_lr_freeze"
  device: "cuda"
  gpu_id: 0

# -----------------------------------------------------------------------------
# Data Settings
# -----------------------------------------------------------------------------
data:
  data_root: "../data"
  train_csv: "train.csv"
  val_csv: "val.csv"
  test_csv: "test.csv"
  train_images_dir: "train/images"
  train_masks_dir: "train/masks"
  val_images_dir: "val/images"
  val_masks_dir: "val/masks"
  test_images_dir: "test/images"
  test_masks_dir: "test/masks"
  image_size: 512
  num_workers: 4
  pin_memory: true
  include_authentic: true
  max_images_per_class: null
  max_samples_train: null
  max_samples_val: null
  max_samples_test: null

# -----------------------------------------------------------------------------
# Model Settings - SegFormer B3 (~47M params)
# -----------------------------------------------------------------------------
model:
  variant: "segformer_b5"
  pretrained: false
  freeze_backbone: true
  freeze_backbone_epochs: 5

# -----------------------------------------------------------------------------
# Loss Settings - Tuned for forgery segmentation
# -----------------------------------------------------------------------------
loss:
  type: "combined"

  bce:
    enabled: true
    weight: 0.3
    use_ilw: true
    ilw_max_weight: 30.0
    ilw_min_weight: 0.05

  dice:
    enabled: true
    weight: 2.5
    smooth: 0.5

  focal:
    enabled: true
    weight: 1.0
    alpha: 0.85
    gamma: 2.5

  edge_weight: 0.5
  cls_weight: 0.15

  tversky_alpha: 0.3
  tversky_beta: 0.7
  tversky_gamma: 0.75

  lambda_pred_score: 0.05
  ignore_label: -1

# -----------------------------------------------------------------------------
# Training Settings - SegFormer B3 on 12 GB VRAM
# batch 2 x accum 16 = effective 32
# -----------------------------------------------------------------------------
training:
  num_epochs: 200
  batch_size: 4
  gradient_accumulation_steps: 2
  lr: 0.0001
  weight_decay: 0.01
  backbone_lr_multiplier: 0.1
  warmup_epochs: 10
  scheduler:
    type: "reduce_on_plateau"
    factor: 0.5
    patience: 8
    min_lr: 0.0000001
  resume_checkpoint: ""
  val_every: 1
  use_amp: true
  use_ema: true
  ema_decay: 0.9995
  grad_clip_norm: 1.0
  early_stopping:
    enabled: true
    patience: 25
    min_delta: 0.00001
    metric: "val_forged_oF1"
    mode: "max"

# -----------------------------------------------------------------------------
# Data Augmentation Settings
# -----------------------------------------------------------------------------
augmentation:
  type: 2
  crop_prob: 0

# -----------------------------------------------------------------------------
# Inference Settings
# -----------------------------------------------------------------------------
inference:
  threshold: 0.40
  min_area: 100

# -----------------------------------------------------------------------------
# Evaluation Settings
# -----------------------------------------------------------------------------
evaluation:
  compute_oF1: true
  oF1:
    threshold: 0.40
    min_area: 100

# -----------------------------------------------------------------------------
# Logging Settings
# -----------------------------------------------------------------------------
logging:
  tensorboard: true
  log_every: 10
  verbose: true
